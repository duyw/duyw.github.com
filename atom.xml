<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[杜永文 博客]]></title>
  <link href="http://duyw.github.com/atom.xml" rel="self"/>
  <link href="http://duyw.github.com/"/>
  <updated>2013-04-04T23:20:30+08:00</updated>
  <id>http://duyw.github.com/</id>
  <author>
    <name><![CDATA[Du Yongwen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ubuntu12.04 安装 Sublime Text 2 ]]></title>
    <link href="http://duyw.github.com/blog/2013/04/04/ubuntu12-dot-04-an-zhuang-sublime-text-2/"/>
    <updated>2013-04-04T22:41:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/04/04/ubuntu12-dot-04-an-zhuang-sublime-text-2</id>
    <content type="html"><![CDATA[<p>Sublime Text 2 是一款非常优秀的编辑器，可以媲美苹果系统下的TextMate，用Sublime Text 2 进行RoR开发是一件很惬意的事，在Ubuntu12.04系统下安装步骤如下：</p>

<ol>
<li><p>到<a href="http://www.sublimetext.com/2">官网</a>下载软件包： “Sublime Text 2.0.1.tar.bz2”。</p></li>
<li><p>复制到安装目录。</p></li>
<li><p>解压缩。</p></li>
<li><p>进入目录，创建desktop文件（sublime-text.desktop），并赋予可执行权限，启动sublime text 2 就直接运行该文件，这样就可以锁定在启动器，内容如下：</p>

<pre><code> #!/usr/bin/env xdg-open

 [Desktop Entry]
 Name=Sublime Text 2
 Comment=Sublime Text 2
 Exec=/home/ivan/apps/"Sublime Text 2"/sublime_text
 Icon=/home/ivan/apps/Sublime Text 2/Icon/256x256/sublime_text.png
 Terminal=false
 Type=Application
 Categories=Application;Development;
 StartupNotify=true
 Name[zh_CN]=sublime-text
</code></pre>

<p> 如果将文件复制到<code>/usr/share/applications/</code>目录下，就可以在Dash中被搜索到。</p></li>
<li><p>破解：</p>

<p> 首先备份安装目录下的sublime_text文件<code>cp sublime_text sublime_text.bak</code></p>

<p> 使用vim打开：<code>vim sublime_text</code> (如果没有安装vim，可以通过命令<code>sudo apt-get install vim</code>安装。)</p>

<p> 将文件转化成16进制,在vim中输入：<code>:%!xxd</code></p>

<p> 查找要修改的地方,在vim中输入： <code>/4333 3342</code></p>

<p> 将3342修改为3242</p>

<p> 将文件转换回去,在vim中输入： <code>:%!xxd -r</code></p>

<p> 保存文件、退出,在vim中输入： <code>:wq</code></p>

<p> 打开sublime text 2 编辑器，将下面的Licence填入即可大功告成：</p>

<pre><code> —–BEGIN LICENSE—–
 China
 Unlimited User License
 EA7E-2861
 BE67D2175D3569FDAB9EB5340FAD2822
 E7B56B3397A76AA9FBE8AC3D3C65918B
 DFC28F2EA158140D9E07853D594818EB
 3A237B2E8E98ED257C269548F50EDA34
 EF0C7F72D8917DB538A0245E46BFD6B1
 85F4EDE331F253530ED67A5C19E92399
 04C5F4A1AF4AF3DB5EC49C1FEE17CA76
 7E369F8AAE4AC6C6E756B5882E1608B9
 —–END LICENSE—–
</code></pre></li>
<li><p>创建链接，这样就可以直接在命令行中通过 sub 命令启动</p>

<p> <code>sudo ln -s /home/ivan/apps/Sublime\ Text\ 2/sublime_text /usr/bin/sub</code></p></li>
<li><p>安装插件安装管理工具“package control”</p>

<p> 打开 Sublime Text 2，按下 Control + ` 调出 Console，输入以下内容，回车执行：</p>

<pre><code> import urllib2,os;pf='Package Control.sublime-package';ipp=sublime.installed_packages_path();os.makedirs(ipp) if not os.path.exists(ipp) else None;open(os.path.join(ipp,pf),'wb').write(urllib2.urlopen('http://sublime.wbond.net/'+pf.replace(' ','%20')).read())
</code></pre></li>
<li><p>解决ubuntu12.04系统下中文输入问题：</p>

<p> 需要通过安装InputHelper插件来实现中文输入：</p>

<p> <code>cd ~/.config/sublime-text-2/Packages/</code></p>

<p> <code>git clone https://github.com/xgenvn/InputHelper.git</code></p>

<p> 也可以通过 package control 来安装.</p>

<p> 使用方法：重启 Sublime Text 2 ,通过快捷键 Shift ＋ Ctrl ＋ Z 来呼出输入窗口，可在其中输入汉字，输入完成直接回车即可。</p></li>
<li><p>相关插件介绍</p>

<p> 待续&#8230;</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu12.04 安装 JDK]]></title>
    <link href="http://duyw.github.com/blog/2013/04/04/ubuntu12-dot-04an-zhuang-jdk/"/>
    <updated>2013-04-04T22:30:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/04/04/ubuntu12-dot-04an-zhuang-jdk</id>
    <content type="html"><![CDATA[<p>很多软件运行需要JRE环境，下面的方法用于在Ubuntu中安装JDK：</p>

<ol>
<li><p>首先下载java，点击<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk6downloads-1902814.html">这里</a>下载
（这里以“jdk-6u26-linux-i586.bin”为例）下载好以后放到安装位置（这里以 ~/apps 目录为例）。</p></li>
<li><p>设置安装文件权限： <code>chmod u+x ./jdk-6u26-linux-i586.bin</code></p></li>
<li><p>安装：<code>sudo -s ./jdk-6u26-linux-i586.bin</code></p></li>
<li><p>配置环境变量：</p></li>
</ol>


<p>  <code>sudo gedit /etc/profile</code></p>

<p>   在文件末尾写入以下内容：</p>

<pre><code>    #set java environment    

    JAVA_HOME=/home/ivan/apps/jdk1.6.0_26   

    export JRE_HOME=/home/ivan/apps/jdk1.6.0_26/jre   

    export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH   

    export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH 

    #set java environment
</code></pre>

<p>5 测试：</p>

<p>  重启terminal,执行： <code>java -version</code> ，输出版本信息，说明安装成功。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GEM 更新]]></title>
    <link href="http://duyw.github.com/blog/2013/04/04/gem-geng-xin/"/>
    <updated>2013-04-04T21:56:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/04/04/gem-geng-xin</id>
    <content type="html"><![CDATA[<p>更新方法：</p>

<ol>
<li><p>从低版本升级到高版本</p>

<p><code>gem update –system</code></p></li>
<li><p>从高版本降到低版本</p></li>
</ol>


<p>  从 <a href="http://rubyforge.org/frs/?group_id=126">RubyForge</a> 下载需要的版本,以tgz格式为例:</p>

<p>  先解压  <code>tar zxf gem_name_xxxxx</code></p>

<p>  cd 进去 <code>ruby setup.rb</code></p>

<p>  查看帮助: <code>ruby setup.rb --help</code></p>

<p>参考：<a href="https://rubygems.org/pages/download">https://rubygems.org/pages/download</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu12.04 安装 PostgreSQL 和 PgAdmin3]]></title>
    <link href="http://duyw.github.com/blog/2013/04/04/ubuntu12-dot-04-an-zhuang-postgresqlhe-pgadmin3/"/>
    <updated>2013-04-04T19:33:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/04/04/ubuntu12-dot-04-an-zhuang-postgresqlhe-pgadmin3</id>
    <content type="html"><![CDATA[<h3>1.安装</h3>

<p>安装：<code>sudo apt-get install postgresql postgresql-client postgresql-server-dev-all</code></p>

<p>或者指定版本号：</p>

<pre><code>sudo apt-get install -y postgresql-9.1 postgresql-client-9.1 postgresql-contrib-9.1 \
postgresql-server-dev-9.1
</code></pre>

<p>启动：<code>sudo /etc/init.d/postgresql start</code></p>

<p>停止：<code>sudo /etc/init.d/postgresql stop</code></p>

<p>重启：<code>sudo /etc/init.d/postgresql restart</code></p>

<p>察看状态：<code>sudo /etc/init.d/postgresql status</code></p>

<p>另外，也可以使用命令：<code>sudo service postgresql  [start/stop/restart/status]</code></p>

<p>以上命令将把PostgreSQL安装到以下目录：</p>

<pre><code>/usr/lib/postgresql/9.1/        存放postgresql相关的二进制文件
/usr/lib/postgresql/9.1/bin/    可执行文件 
/usr/lib/postgresql/9.1/lib/    共享库文件 
/etc/postgres/9.1/main/         存放postgresql配置文文件 
/var/lib/postgresql/            postgres用户的主文件夹
</code></pre>

<!-- more -->


<h3>2.配置管理员“postgres”，使用psql</h3>

<p>PostgreSQL数据默认会创建一个linux用户postgres，需要修改操作系统“postgres”用户的密码为“postgres”：</p>

<ol>
<li><p>删除密码：<code>sudo passwd -d postgres  //passwd -d 是清空指定用户密码的意思</code></p></li>
<li><p>设置密码：<code>sudo -u postgres passwd  //或者 sudo su postgres -c passwd</code></p></li>
</ol>


<p>用sudo权限以用户postgres身份登陆PostgreSQL:</p>

<pre><code>sudo -u postgres psql [ -U postgres -h 127.0.0.1]   
// 运行psql,后面[]中的内容可选，用于登录服务器，默认会登录本机；
</code></pre>

<p>或者：</p>

<p><code>sudo su postgres -c psql template1（PostgreSQL的默认数据库是template1）</code></p>

<p>运行 PostgreSQL 交互的终端程序， 叫 psql，它允许你交互地输入，编辑，和执行 SQL 命令。</p>

<p>启动 psql：<code>psql mydb</code>（以用户postgres登陆psql：<code>sudo su postgres -c psql</code>）</p>

<p>在 psql 里输入help命令，你会看到下面的提示信息：</p>

<pre><code>You are using psql, the command-line interface to PostgreSQL.
Type:  \copyright for distribution terms
          \h for help with SQL commands
          \? for help with psql commands
          \g or terminate with semicolon to execute query
          \q to quit
</code></pre>

<p>修改PostgreSQL的管理员用户postgres的密码为“postgres”（同操作系统用户postgres的密码一样）：</p>

<p><code>postgres=# ALTER USER postgres WITH PASSWORD 'postgres';</code></p>

<p>查询当前使用的postgresql版本：<code>SELECT version()；</code></p>

<p>查询大概年前日期：            <code>SELECT current_date;</code></p>

<p>现在，我们就可以在数据库服务器上用 postgres帐号通过psql或者pgAdmin等等客户端操作数据库了
（暂时还不能远程访问）。</p>

<h3>3.管理PostgreSQL用户</h3>

<p>1 创建新用户pgsql，但不给建数据库的权限，有两中创建方式：</p>

<p><strong>一种是在外部命令行直接创建：</strong></p>

<p>  命令：<code>createuser [-a] [-A] [-d] [-D] [-e] [-P] [-h 主机名] [-p port] 用户名</code></p>

<pre><code>参数说明：
[-a]：允许创建其他用户，相当于创建一个超级用户；
[-A]：不允许此用户创建其他用户；
[-d]：允许此用户创建数据库；
[-D]：不允许此用户创建数据库；
[-e]：将执行过程显示到Shell上；
[-P]：创建用户时，同时设置密码；
[-h 主机名]：为某个主机上的Postgres创建用户；
[-p port]：与-h参数一同使用，指定主机的端口。
</code></pre>

<p>例如：</p>

<p><code>ivan@ubuntu:~$ sudo -u postgres createuser -D -P pgsql</code></p>

<p>执行以后会看到如下提示：</p>

<pre><code>Enter password for new role: 
Enter it again: 
Shall the new role be a superuser? (y/n) n
Shall the new role be allowed to create more new roles? (y/n) n
</code></pre>

<p><strong>另一种方式是登陆psql，通过SQL语句创建：</strong></p>

<p>首先登陆：</p>

<p><code>ivan@ubuntu:~$ psql -U postgres -h 127.0.0.1</code></p>

<p>然后创建：</p>

<pre><code>postgres=# create user “pgsql” with password ‘123456’ nocreatedb; 
//用户名和数据库名称加上引号后才区分大小写，否则会自动转换成小写
</code></pre>

<p>2 删除用户：</p>

<p>外部：<code>sudo -u postgres dropuser pgsql</code></p>

<p>内部：&#8220;</p>

<h3>4.创建和删除数据库</h3>

<p>同样有外部命令行和psql的SQL语句这两种创建方式。</p>

<p>创建数据库 mydb, 其拥有者是pgsql用户：</p>

<p>1  通过命令行创建（shell命令）：</p>

<p>创建数据库：<code>sudo -u postgres createdb mydb -O pgsql   // -O 设定所有者pgsql；</code></p>

<p>删除数据库：<code>sudo -u postgres dropdb   mydb</code></p>

<p>2  通过psql来创建(sql命令)：</p>

<p>首先利用psql登录PostgreSQL服务器:</p>

<pre><code>sudo -u postgres psql [ -U postgres -h 127.0.0.1]  
//运行psql,后面[]中的内容可选，用于登录服务器，默认会登录本机；`
</code></pre>

<p>然后在psql程序中创建数据库（需要先创建好pgsql用户）:</p>

<p><code>create database “mydatabase” with owner=pgsql;</code></p>

<h3>5.数据库导入导出</h3>

<p><strong>导出：</strong>取得服务器 192.168.1.1 上 PostgreSQL中pgsql用户的mydb数据库，导出到当前目录下的 mydb.dump 文件：</p>

<p><code>pg_dump -h 192.168.1.1 -U pgsql -Fc mydb &gt; mydb.dump</code></p>

<p><strong>导入：</strong>将导出的文件 mydb.dump 导入到本地PostgreSQL数据库中pgsql用户下(需要提前创建pgsql用户），要求导入后的数据库名称为“mydb”</p>

<p><code>pg_restore ./mydb.dump | psql -Upgsql -d mydb</code></p>

<h3>6.修改PostgresSQL数据库配置实现远程访问</h3>

<p><code>ivan@ubuntu:~$ sudo vim /etc/postgresql/9.1/main/postgresql.conf</code></p>

<p>1.监听任何地址访问，修改连接权限</p>

<p><code>#listen_addresses = ‘localhost’  改为 listen_addresses = ‘*’</code></p>

<p>2.启用密码验证</p>

<p><code>#password_encryption = on      改为   password_encryption = on</code></p>

<p>3.可访问的用户ip段</p>

<p><code>ivan@ubuntu:~$ sudo vim /etc/postgresql/9.1/main/pg_hba.conf</code></p>

<p>并在文档末尾加上以下内容</p>

<pre><code># to allow your client visiting postgresql server
host all all 0.0.0.0 0.0.0.0 md5
</code></pre>

<p>解释一下最后一行：</p>

<pre><code>host表示允许的类型是主机； 
第一个all是允许的数据库名字； 
第二个all是允许的用户； 
第一个0.0.0.0是允许访问的ip address； 
第二个0.0.0.0是允许访问的subnet mask； 
最后的md5表示密码的加密方式，如果将md5改成trust则可以让指定范围的主机数据库的时候不需要提供密码。
关于 ip address 和 subnet mask ，你也可以修改为你的机器IP地址(如10.13.19.53)和子网掩码(如 255.255.255.255)，
这样就只有你自己的主机可以远程访问数据库了。 如果要使用一个IP地址范围，只需要把子网掩码设置成合适的值，
如果子网掩码设置成0.0.0.0，则所有主机均可以访问数据库（IP可以任意设定），
如果将md5改成trust则可以让指定范围的主机访问指定的数据库的时候不需要提供密码。
</code></pre>

<p>4.重启PostgreSQL数据库</p>

<p><code>ivan@ubuntu:~$ sudo /etc/init.d/postgresql restart</code></p>

<h3>7.安装postgresql数据库pgAdmin3客户端管理程序</h3>

<p><code>ivan@ubuntu:~$ sudo apt-get install -y pgadmin3</code></p>

<p>遇到问题：</p>

<p>1 安装过程中总是下载不了要安装的文件，更新源添加163源都无法解决，最后通过vpn翻墙以后可以正常安装。</p>

<p>2 安装以后pgAdmin3固定到启动器后不显示图标，解决方法，修改/usr/share/applications目录下的 pgAdmin III.desktop文件，将其中的 Icon值改为“/usr/share/pixmaps/pgadmin3.svg”，搞定。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Git 常用命令]]></title>
    <link href="http://duyw.github.com/blog/2013/03/13/git-chang-yong-ming-ling/"/>
    <updated>2013-03-13T14:19:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/03/13/git-chang-yong-ming-ling</id>
    <content type="html"><![CDATA[<h2>Git 指令结构图</h2>

<p><img src="http://duyw.github.com/images/post/git-transport.png" title="Git 指令结构图" alt="Git 指令结构图" /></p>

<p>图片中展示了Git Repository结构和执行相关Command后数据的变迁流程，Git维护的代码分成三个部分</p>

<ul>
<li><p>current working directory 当前工作目录 (1)</p></li>
<li><p>index file 暂存区 (2)</p></li>
<li><p>git repository 历史仓库 (3)</p></li>
</ul>


<!-- more -->


<p><img src="http://duyw.github.com/images/post/basic-usage.svg" title="Git 指令结构图" alt="Git 指令结构图" /></p>

<p><code>git add</code>命令会将(1)的改变写到(2)</p>

<p><code>git commit</code> 将(2)的改变写到(3)</p>

<p><code>git commit -a</code> 会直接将(1)中的改动同时写到(2)和(3)</p>

<p><code>git reset</code> 用来撤销最后一次git add files，也可以用来撤销所有暂存区域文件。</p>

<p><code>git checkout</code> 把文件复制到工作目录或者暂存区域，可以用来撤销在当前工作目录中的修改。</p>

<p><code>git checkout HEAD --files</code>将仓库中的文件覆盖到工作目录。</p>

<p><code>git diff</code> 命令用来查看差异：</p>

<ul>
<li><p>git diff 得到的是从(2)到(1)的变化</p></li>
<li><p>git diff –cached 得到的是从(3)到(2)的变化</p></li>
<li><p>git diff HEAD 得到的是从(3)到(1)的变化</p></li>
<li><p>git diff <source_branch> <target_branch>  查看分支间差异</p></li>
</ul>


<h2>Git的基本命令举例</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># 帮助和配置</span>
</span><span class='line'>git <span class="nb">help command</span>                          查看帮助
</span><span class='line'>git <span class="nb">command</span> –help                         查看帮助
</span><span class='line'>git config –global user.name &lt;username&gt;   设置用户名
</span><span class='line'>git config –global user.email &lt;email&gt;     设置用户邮箱
</span><span class='line'>git config –list                          查看用户信息
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># 新建仓库</span>
</span><span class='line'>git init                                     初始化
</span><span class='line'>git clone /path/to/repository                创建一个本地仓库的克隆
</span><span class='line'>git clone username@host:/path/to/repository  创建一个远端服务器仓库的克隆
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git add 命令  含义</span>
</span><span class='line'>git add file_name                 加单个文件到缓存区
</span><span class='line'>git add .                         加当前目录的所有文件到缓存区
</span><span class='line'>git add -i                        进入交互式add
</span><span class='line'>git add -p                        直接进入补丁模式，可以暂存修改的一部分。
</span><span class='line'>git remote add origin &lt;server&gt;    修改推送到远程的服务器
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git commit 命令 含义</span>
</span><span class='line'>git commit -m “代码提交信息”         提交改动
</span><span class='line'>git commit -a                      第一步：自动地add所有改动的代码，使得所有的开发代码都列于index file中；第二步：自动地删除那些在index file中但不在工作树中的文件；第三步：执行commit命令来提交。
</span><span class='line'>git commit –amend -m “新的提交信息”  提交改动（若有改动） + 修补最近一次提交
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git push 命令 含义</span>
</span><span class='line'>git push origin <span class="nb">test</span>:test2      提交本地test分支作为远程test2分支
</span><span class='line'>git push origin <span class="nb">test</span>            提交本地test分支作为远程test分支
</span><span class='line'>git push origin :test           删除远程test分支
</span><span class='line'>git push origin :refs/tags/t4   删除远程tag标签t4
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git pull 命令 含义</span>
</span><span class='line'>git pull                    从仓库取回代码，更新本地仓库至最新
</span><span class='line'>git pull origin <span class="nb">test</span>:test2  取回远程的test分支作为本地的test2分支
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git checkout 命令 含义</span>
</span><span class='line'>git checkout master         切换回主分支
</span><span class='line'>git checkout <span class="nb">test</span>           如果本地无test分支，先需要从远程pull回test分支
</span><span class='line'>git checkout -b feature_x   创建一个叫做“feature_x”的分支，并切换过去
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git branch 命令 含义</span>
</span><span class='line'>git branch b4 t4          以tag t4建立新的分支b4
</span><span class='line'>git branch -d feature_x   删除分支
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git merge 命令  含义</span>
</span><span class='line'>git merge AAA             将分支AAA与当前分枝合并
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git diff 命令 含义</span>
</span><span class='line'>git diff  查看working tree与index file的差别的（这个命令只在git add之前使用有效。如果已经add了，那么此命令输出为空）。
</span><span class='line'>git diff –cached  查看index file与commit的差别的（这个命令在git add之后在git commit之前有效。）。
</span><span class='line'>git diff HEAD 查看working tree和commit的差别的。（你一定没有忘记，HEAD代表的是最近的一次commit的信息）
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git reset 命令  含义</span>
</span><span class='line'>git reset –soft     只撤销commit，保留working tree和index file。
</span><span class='line'>git reset –mixed    撤销commit和index file，保留working tree
</span><span class='line'>git reset –hard     撤销commit、index file和working tree，即撤销销毁最近一次的commit
</span><span class='line'>git reset           和git reset –mixed完全一样
</span><span class='line'>git reset –         用于删除登记在index file里的某个文件。例如：git reset – roc.c
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># git revert 命令 含义</span>
</span><span class='line'>git revert  用于回滚（撤销）一些commit。对于一个或者多个已经存在的commit，去除由这些commit引入的改变，并且用一个新的commit来记录这个回滚操作。这个命令要求working tree必须是干净的。
</span><span class='line'>git revert HEAD~3 丢弃最近的三个commit，把状态恢复到最近的第四个commit，并且提交一个新的commit来记录这次改变。
</span><span class='line'>git revert -n master~5..master~2  丢弃从最近的第五个commit（包含）到第二个（不包含）,但是不自动生成commit，这个revert仅仅修改working tree和index。
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># 其他命令</span>
</span><span class='line'>git merge &lt;branch&gt;  合并其他分支到当前分支
</span><span class='line'>git log             获取提交 ID
</span><span class='line'>git tag 1.0.0 &lt;ID&gt;  创建一个叫做 1.0.0 的标签
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A simple Script for installing RoR on Ubuntu12.04]]></title>
    <link href="http://duyw.github.com/blog/2013/03/04/a-simple-script-for-installing-ror-on-ubuntu12-dot-04/"/>
    <updated>2013-03-04T11:48:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/03/04/a-simple-script-for-installing-ror-on-ubuntu12-dot-04</id>
    <content type="html"><![CDATA[<p>This is a usful script,I found it here: <a href="http://blog.sudobits.com/2012/05/02/how-to-install-ruby-on-rails-in-ubuntu-12-04-lts/">Sudobits 博客</a></p>

<figure class='code'><figcaption><span>rails-installer.sh </span><a href='https://github.com/rkjha/RailsOnUbuntu/blob/master/rails-installer.sh'>链接到github </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c"># A simple Script for installing Rails on Ubuntu 12.04 LTS / 12.10</span>
</span><span class='line'><span class="c"># It will also install the dependencies required as well as the RVM</span>
</span><span class='line'><span class="c"># Author: Ramesh Jha (ramesh@rameshjha.com),(http://blog.sudobits.com)</span>
</span><span class='line'><span class="c"># License: MIT </span>
</span><span class='line'>
</span><span class='line'><span class="nv">RUBY_VERSION</span><span class="o">=</span><span class="s2">&quot;1.9.3&quot;</span>
</span><span class='line'><span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;$HOME/install.log&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Rails Installer started&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Installing Dependencies</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;.......Updating package cache.....&quot;</span>
</span><span class='line'>sudo apt-get update &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;......Done..........&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;..........Installing git..........&quot;</span>
</span><span class='line'>sudo apt-get -y install git &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;..........Done....................&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Installing Curl&quot;</span>
</span><span class='line'>sudo apt-get -y install curl &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;...........Done...................&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># Install RVM (Ruby Version Manager)</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;.....Installing RVM..............&quot;</span>
</span><span class='line'>curl -L get.rvm.io | bash -s stable &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'>
</span><span class='line'><span class="c"># fallback for the above command (in case of certificates errors)</span>
</span><span class='line'><span class="c">#if ($? !=0)</span>
</span><span class='line'><span class="c"># then</span>
</span><span class='line'><span class="c">#  curl -kL get.rvm.io | bash -s stable</span>
</span><span class='line'><span class="c">#fi  </span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;............DONE..........&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;......Loading RVM..........&quot;</span>
</span><span class='line'><span class="nb">source</span> ~/.rvm/scripts/rvm &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;...........Done...........&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Install Additional Dependencies</span>
</span><span class='line'>
</span><span class='line'>sudo apt-get -y install build-essential openssl libreadline6 libreadline6-dev zlib1g zlib1g-dev libssl-dev libyaml-dev libsqlite3-0 libsqlite3-dev sqlite3 libxml2-dev libxslt-dev autoconf libc6-dev ncurses-dev automake libtool bison subversion
</span><span class='line'>
</span><span class='line'><span class="c"># Install nodejs from the PPA</span>
</span><span class='line'>sudo apt-add-repository -y ppa:chris-lea/node.js
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get -y install nodejs
</span><span class='line'>
</span><span class='line'><span class="c"># Install Latest version of Ruby</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;........Installing Ruby v $RUBY_VERSION ...&quot;</span>
</span><span class='line'>rvm install <span class="nv">$RUBY_VERSION</span> &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;==&gt; Done.........&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;If you want to install another version of ruby e.g 1.8.7&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Then use the command &#39;rvm install 1.8.7&#39; &quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Select and Set latest version of ruby as the default so that</span>
</span><span class='line'><span class="c"># You won&#39;t have to select each time you start a terminal</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;.......Setting the default version of Ruby...&quot;</span>
</span><span class='line'>rvm --default use <span class="nv">$RUBY_VERSION</span> &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;==&gt; Done.........&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Now, You are using Ruby $RUBY_VERSION by default&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;if you want to change that then use &#39;rvm --default &lt;ruby_version&gt;&#39; &quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Install Latest version of Rails</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;..........Installing Rails gem................&quot;</span>
</span><span class='line'>gem install rails &gt;&gt;<span class="nv">$LOG_FILE</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;.........Done&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;######################################&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;###### Installation Completed ########&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;######################################&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;if something went wrong then checkout the log file $LOG_FILE&quot;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress simple guide]]></title>
    <link href="http://duyw.github.com/blog/2013/02/28/octopress-simple-guide/"/>
    <updated>2013-02-28T18:15:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/02/28/octopress-simple-guide</id>
    <content type="html"><![CDATA[<p>Octopress的搭建过程如下：</p>

<h3>1 配置本地Octopress</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/imathis/octopress.git davidpan.github.com
</span><span class='line'>cd davidpan.github.com 
</span><span class='line'>gem install bundler 
</span><span class='line'>bundle install 
</span><span class='line'>rake install</span></code></pre></td></tr></table></div></figure>


<h3>2 关联到 GitHub</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake setup_github_pages
</span><span class='line'>
</span><span class='line'># 输入git源：git://github.com/duyw/duyw.github.com.git
</span><span class='line'># 命令执行之后 会生成一个 _deploy 目录，该目录本身也是一个git的仓库</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h3>3 修改配置文件</h3>

<p>修改OctoPress根目录 _config.yml</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url:  http://username.github.com     # 博客地址
</span><span class='line'>title:                               # 博客标题 
</span><span class='line'>subtitle:                            # 副标题 
</span><span class='line'>author:                              # 作者 
</span><span class='line'>simple_search:  http://www.google.com.hk/search     # 搜索引擎 
</span><span class='line'>description:                                        # 关于博客的描述 
</span><span class='line'>subscribe_rss:  /atom.xml            # Rss订阅地址, 默认是  /atom.xml 
</span><span class='line'>subscribe_email:                     # 提供Email订阅的地址 
</span><span class='line'>email:                               # Rss订阅的Email地址
</span><span class='line'>root:  /               # 博客路径，默认是“/“，如果你打算在子目录中，记得修改这个路径 
</span><span class='line'>permalink: /blog/:year/:month/:day/:title/           # 文章的固定链接形式</span></code></pre></td></tr></table></div></figure>


<h3>4 跟换主题</h3>

<p>主题位于octopress根目录的 .theme 文件夹下，以安装&#8217;slash&#8217;主题为例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd .theme
</span><span class='line'>git clone git://github.com/tommy351/Octopress-Theme-Slash.git slash
</span><span class='line'>rake install['slash']
</span><span class='line'>rake generate</span></code></pre></td></tr></table></div></figure>


<blockquote><p>提示： 更改网站样式相关</p>

<p><a href="https://github.com/imathis/octopress/wiki/Octopress-Sites">https://github.com/imathis/octopress/wiki/3rd-Party-Octopress-Themes</a></p>

<p><a href="https://github.com/imathis/octopress/wiki/Octopress-Sites">https://github.com/imathis/octopress/wiki/Octopress-Sites</a></p></blockquote>

<h3>5 添加文章</h3>

<p>执行 <code>rake new_post["my first blog"]</code> ,</p>

<p>这样会在octopress的/source/_post下生成一个markdown文件，可以用文本软件进行编辑</p>

<h3>6 新建页面</h3>

<p>命令：<code>rake new_page["page_name"]</code></p>

<blockquote><p>提示：修改source/_include/custom 文件，可将页面添加到导航栏。</p></blockquote>

<h3>7 生成静态页面，预览，发布</h3>

<p>完成编辑后执行<code>rake generate</code>，生成静态页面（将source和sass下的源码生成到public目录）。
执行<code>rake preview</code>，启动本地预览，可以在浏览器内以这个地址进行预览。
最后执行rake deploy，将日志提交到github上（将生成到public中的内容复制到_deploy目录，并提交到github的master分支）。</p>

<blockquote><p>提示：generate 和 deploy 可以用一条命令搞定： rake gen_deploy</p></blockquote>

<h3>8 将修改备份到github的source分支上</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -m 'your message'
</span><span class='line'>git push origin source</span></code></pre></td></tr></table></div></figure>


<h3>9 补充</h3>

<ul>
<li><p>查询所有rake参数 ： <code>rake -T</code></p></li>
<li><p>添加附加功能</p>

<p>1 使用google的 Analytics 监控网站流量，需要先申请账号。</p>

<p>  先将需要添加的代码添加到 source/_includes 文件中</p>

<p>  然后配置 google_analytics_tracking_id 项 （位于_config.yml文件中）。</p>

<p>2 添加评论，使用 DISQUS 实现。同样需要修改 _config.yml 文件</p></li>
</ul>


<br /><br /><br />


<hr />

<br />


<h3>为github上已有的oct opress配置本地环境 方法一</h3>

<ol>
<li><p>直接将远程仓库签出到本地</p>

<p> <code>git clone git@github.com:duyw/duyw.github.com.git duyw.github.com</code></p></li>
<li><p>签出source分支的源码</p>

<p> <code>cd duyw.github.com</code></p>

<p> <code>git checkout sources</code></p>

<p> 这样当前项目就有了两个分支,查看分支命令： git branch</p></li>
<li><p>安装依赖</p>

<p> <code>bundle install</code></p></li>
<li><p>配置和github的关联</p>

<p> <code>rake setup_github_pages</code></p></li>
<li><p>生成预览部署</p>

<p> <code>rake generate</code></p>

<p> <code>rake preview</code></p>

<p> <code>rake deploy</code></p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[markdown使用学习]]></title>
    <link href="http://duyw.github.com/blog/2013/02/28/markdownshi-yong-xue-xi/"/>
    <updated>2013-02-28T15:13:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/02/28/markdownshi-yong-xue-xi</id>
    <content type="html"><![CDATA[<h3>Markdown简介</h3>

<hr />

<p>　　Markdown 是一种轻量级的标记语言，由John Gruber和Aaron Swartz创建，使其成为可读性最大并可再发行的可输入输出的格式。这种语言创建灵感来自于已经存在的带标记的电子邮件文本。Markdown 允许 HTML 语法，所以使用者如果需要可以直接用 HTML来表示是可以的。Markdown最初由Gruber应用在Perl语言中，但现在已经有多种编程语言应用了。它是开源项目，并以BSD-style许可证的许可方式以插件形式或内容管理系统形式发布。</p>

<!-- more -->


<h3>快速上手</h3>

<hr />

<h3>标题</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 这是 H1
</span><span class='line'>
</span><span class='line'>## 这是 H2
</span><span class='line'>
</span><span class='line'>###### 这是 H6</span></code></pre></td></tr></table></div></figure>


<h3>文字样式</h3>

<p>粗体用“<em>*”或者“__”包围，斜体用“</em>”或者“_”</p>

<p>粗体： <strong>粗体</strong>      写法：<code>**粗体**</code>或者<code>__粗体__</code></p>

<p>斜体： <em>斜体</em>      写法： <code>_斜体_</code>或者<code>*斜体*</code></p>

<h3>分隔符</h3>

<p>在一行中使用三个或三个以上的*、-或_可以添加分隔线，其中可以有空白，但是不能有其他字符。</p>

<h3>段落</h3>

<p>　　由一个或多个连续的文本行组成，它的前后要有一个以上的空行。</p>

<h3>引用</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt; 这是一个引用，
</span><span class='line'>&gt; 这里木有换行，   
</span><span class='line'>&gt; 在这里换行了。
</span><span class='line'>&gt; &gt; 内部嵌套</span></code></pre></td></tr></table></div></figure>


<p>效果：</p>

<blockquote><p>这是一个引用，
这里木有换行， <br/>
在这里换行了。</p>

<blockquote><p>内部嵌套</p></blockquote></blockquote>

<h3>列表</h3>

<p>　　Markdown 支持有序列表和无序列表。</p>

<ul>
<li>无序列表使用星号、加号或是减号作为列表标记：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*   Red
</span><span class='line'>*   Green
</span><span class='line'>*   Blue</span></code></pre></td></tr></table></div></figure>


<p>等同于：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+   Red
</span><span class='line'>+   Green
</span><span class='line'>+   Blue</span></code></pre></td></tr></table></div></figure>


<p>也等同于：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-   Red
</span><span class='line'>-   Green
</span><span class='line'>-   Blue</span></code></pre></td></tr></table></div></figure>


<ul>
<li>有序列表则使用数字（任意数字即可，相同数字也ok）接着一个英文句点：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1.  Bird
</span><span class='line'>2.  McHale
</span><span class='line'>3.  Parish</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1.  Bird
</span><span class='line'>1.  McHale
</span><span class='line'>1.  Parish</span></code></pre></td></tr></table></div></figure>


<h3>内容区块</h3>

<p>用一个缩进或者反单引号来将需要突出显示内容区块
例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>以热爱祖国为荣，以危害祖国为耻；
</span><span class='line'>以服务人民为荣，以背离人民为耻；
</span><span class='line'>以崇尚科学为荣，以愚昧无知为耻；
</span><span class='line'>以辛勤劳动为荣，以好逸恶劳为耻；
</span><span class='line'>以团结互助为荣，以损人利己为耻；
</span><span class='line'>以诚实守信为荣，以见利忘义为耻；
</span><span class='line'>以遵纪守法为荣，以违法乱纪为耻；
</span><span class='line'>以艰苦奋斗为荣，以骄奢淫逸为耻。</span></code></pre></td></tr></table></div></figure>


<pre><code>以热爱祖国为荣，以危害祖国为耻；
以服务人民为荣，以背离人民为耻；
以崇尚科学为荣，以愚昧无知为耻；
以辛勤劳动为荣，以好逸恶劳为耻；
以团结互助为荣，以损人利己为耻；
以诚实守信为荣，以见利忘义为耻；
以遵纪守法为荣，以违法乱纪为耻；
以艰苦奋斗为荣，以骄奢淫逸为耻。
</code></pre>

<h3>代码区块</h3>

<ul>
<li>用三个 “`”符号包围代码：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>```
</span><span class='line'>def update
</span><span class='line'>  respond_to do |format|
</span><span class='line'>    if @comment.update_attributes(params[:comment])
</span><span class='line'>      format.js
</span><span class='line'>    else
</span><span class='line'>      render :json =&gt; :error
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>`` `</span></code></pre></td></tr></table></div></figure>


<p>Octopress中可以为代码着色，写法：</p>

<figure class='code'><figcaption><span>代码说明： </span><a href='http://www.baidu.com'>链接到百度 </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@comment</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:comment</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">js</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">fromat</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>单行代码</li>
</ul>


<p>用反引号包围要显示的<code>单行</code>代码片段:
<code>&lt;img src="http://duyw.github.com/path/to/img.jpg" alt="alt text" title="Title" /&gt;</code></p>

<h3>图片</h3>

<p><img src="http://l.ruby-china.org/assets/text_logo-e616f2a05abc2e0ebea1f8c6cac685d7.png" title="Ruby China的logo" alt="Ruby China的logo" />
写法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![Ruby China的logo](http://l.ruby-china.org/assets/text_logo-e616f2a05abc2e0ebea1f8c6cac685d7.png "Ruby China的logo")</span></code></pre></td></tr></table></div></figure>


<p>图片的另一种写法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![第一张百度logo图][id1]
</span><span class='line'>![第二张百度logo图][id2]
</span><span class='line'>
</span><span class='line'>[id1]: http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif  "Optional title attribute1"
</span><span class='line'>[id2]: http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif  "Optional title attribute2"</span></code></pre></td></tr></table></div></figure>


<p>效果：</p>

<p><img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" title="Optional title attribute1" alt="第一张百度logo图" />
<img src="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif" title="Optional title attribute2" alt="第二张百度logo图" />
在octopress中图片写法：</p>

<pre><code>&lt;img class="[left|right] [class names]" src="http://duyw.github.com/path/to/image" title="[width] [height] [title text [alt text]]" &gt;
</code></pre>

<p>效果</p>

<p><img src="http://placekitten.com/890/280">
<img class="left" src="http://placekitten.com/320/250" title="Place Kitten #2" >
<img class="right" src="http://placekitten.com/300/500" width="150" height="250" title="Place Kitten #3" >
<img class="right" src="http://placekitten.com/300/500" width="150" height="250" title="Place Kitten #4" alt="An image of a very cute kitten"></p>

<h3>链接</h3>

<p>这是一个无title链接： <a href="http://www.baidu.com/">百度</a>
写法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[百度](http://www.baidu.com/)</span></code></pre></td></tr></table></div></figure>


<p>这是一个有title链接： <a href="http://www.baidu.com/" title="点击打开百度首页">百度</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[百度](http://www.baidu.com/ "点击打开百度首页")</span></code></pre></td></tr></table></div></figure>


<p>I get 10 times more traffic from <a href="http://google.com/" title="Google">Google</a> than from
<a href="http://search.yahoo.com/" title="Yahoo Search">Yahoo</a> or <a href="http://search.msn.com/" title="MSN Search">MSN</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>I get 10 times more traffic from [Google][aaaa] than from
</span><span class='line'>[Yahoo][bbbb] or [MSN][cccc].
</span><span class='line'>[aaaa]: http://google.com/ "Google"
</span><span class='line'>[bbbb]: http://search.yahoo.com/ "Yahoo Search"
</span><span class='line'>[cccc]: http://search.msn.com/ "MSN Search"</span></code></pre></td></tr></table></div></figure>


<p>最后贴一张儿子的照片 ～～～</p>

<p><img src="http://p13.freep.cn/p.aspx?u=v20_p13_photo_1302281746571604_0.jpg" title="儿子照片" alt="儿子照片" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My first blog]]></title>
    <link href="http://duyw.github.com/blog/2013/02/27/my-first-blog/"/>
    <updated>2013-02-27T10:59:00+08:00</updated>
    <id>http://duyw.github.com/blog/2013/02/27/my-first-blog</id>
    <content type="html"><![CDATA[<p>　　这是搭建Octopress后写的第一篇 blog，另外为博客添加了gogle Analytics 和 DISQUS，小小的激动了一下，  哈哈。</p>

<p>　　这个博客专门用来分享技术学习笔记，以前写过很多，有的记录在本地，有的分散在各个博客系统，有机会把有用的东西陆续整理过来。</p>

<p>　　comme on  加油～！！！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[virtualbox中虚拟硬盘扩容]]></title>
    <link href="http://duyw.github.com/blog/2011/04/04/virtualboxzhong-xu-ni-ying-pan-kuo-rong/"/>
    <updated>2011-04-04T17:17:00+08:00</updated>
    <id>http://duyw.github.com/blog/2011/04/04/virtualboxzhong-xu-ni-ying-pan-kuo-rong</id>
    <content type="html"><![CDATA[<p>VirtualBox中虚拟硬盘扩容（vdi或者vmdk文件）扩容：</p>

<p>　　今天在使用虚拟机的时候发现分配的硬盘空间不足，需要扩大容量，最简单的办法就是重新创建一个虚拟硬盘，然后挂载到虚拟系统中即可，考虑到虚拟系统的备份迁移等问题，我想直接将vmdk格式的虚拟硬盘扩容，最后操作成功，记录在此。</p>

<p>　　其实创建和安装虚拟系统的时候可以将虚拟容量设置的大一些，比如可以设置50G，这50G动态扩大的，虚拟操作系统真正使用了多少，文件在外面系统中就占用多大的空间，这个文件大小最大限度是50G，所以不必担心会浪费的硬盘资源。</p>

<p>　　如果你使用的是VMWare，将已有虚拟系统扩容则直接一条命令就可以搞定，方法google便知。</p>

<p>　　但是VirtualBox就没那么方便了，因为VirtualBox不能改变已经创建的虚拟硬盘的大小，这一点很不人性化，但总是有办法的，操作的思路是先新建一个容量较大的vdi虚拟硬盘，然后将现有vdi虚拟硬盘的数据复制过去，然后把新建的虚拟硬盘挂载到虚拟系统中将原来的虚拟硬盘删除即可，复制的时候使用VBoxManage的 clonevdi 命令即可。</p>

<p>　　需要提醒的是启动虚拟系统后查看硬盘大小并没有改变，需要在虚拟系统中创建分区分配盘符。</p>

<p>　　VirtualBox与VMWare创建的虚拟系统都是vmdk格式的， 此外VirtualBox还支持vdi格式，如果你现有虚拟系统是vmdk格式的，那么要转换成vdi，然后将内容复制到新的vdi虚拟硬盘中，我找到两种方法可以实现转换：</p>

<!-- more -->


<h3>方法一：vmdk —> bin —> vdi</h3>

<p>从vmdk转换到bin需要下载 QemuManager安装工具，操作示例：</p>

<p>vmdk —> bin</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> "d:\Program Files\QemuManager\qemu\qemu-img.exe" convert "E:\virtualOS\server2003\win2003.vmdk" -O raw "E:\virtualOS\server2003\win2003.bin"</span></code></pre></td></tr></table></div></figure>


<p>bin —> vdi</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"D:\Program Files\Oracle\VirtualBox\VBoxManage.exe" convertfromraw "E:\virtualOS\server2003\win2003.bin" "E:\virtualOS\server2003\win2003.vdi"</span></code></pre></td></tr></table></div></figure>


<h3>方法二：直接转换</h3>

<p>但是我在操作的过程中没有成功，不知道什么原因，你可以尝试一下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBoxManage clonehd source.vmdk target.vdi --format VDI</span></code></pre></td></tr></table></div></figure>


<p>另外如果将vdi转换成vmdk：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBoxManage clonehd source.vdi target.vmdk --format VMDK</span></code></pre></td></tr></table></div></figure>


<p>通过前面的操作，接下来将原来的vid虚拟硬盘数据复制到新的vid硬盘，示例：</p>

<p>旧vdi —> 新vdi</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"D:\Program Files\Oracle\VirtualBox\VBoxManage.exe"  clonevdi "E:\virtualOS\server2003\win2003.vdi"  "E:\virtualOS\server2003\server2003.vdi" --existing</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails 连接 Oracle]]></title>
    <link href="http://duyw.github.com/blog/2010/12/29/rails-lian-jie-oracle/"/>
    <updated>2010-12-29T14:06:00+08:00</updated>
    <id>http://duyw.github.com/blog/2010/12/29/rails-lian-jie-oracle</id>
    <content type="html"><![CDATA[<p>我的环境如下：</p>

<pre><code>ruby 1.8.7

rails 2.3.8 

本机安装 Oracle 11g客户端

另一台电脑安装 Oracle 11g的服务器端
</code></pre>

<p>需要用到的gem包：</p>

<pre><code>ruby-oci8

activerecord-oracle-adapter
</code></pre>

<h3>操作步骤：</h3>

<p> activerecord-oracle-adapter插件的使用说明：<a href="http://github.com/rsim/oracle-enhanced/wiki/Usage">跳转</a></p>

<h4>1.首先将oracle客户端添加到系统环境变量中。</h4>

<pre><code>注意：

* Oracle 的密码不能为纯数字，否则报错。

* 安装好客户端后要确保安装无误，可以访问到服务器。
</code></pre>

<h4>2.安装需要的gem包</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install ruby-oci8-2.0.4-x86-mingw32.gem
</span><span class='line'>gem install activerecord-oracle-adapter --source http://gems.rubyonrails.org</span></code></pre></td></tr></table></div></figure>


<p>注意：安装好 oci8 后要测试 是否安装正确 方法是打开 irb 输入 require ‘oci8’ 如果不报错说明安装成功。</p>

<p>另外可以用oci8测试 查询：</p>

<figure class='code'><figcaption><span>Ruby代码: </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">OCI8</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;dyw1&#39;</span><span class="p">,</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="s1">&#39;192.168.23.162/orcl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s1">&#39;select * from journals&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">r</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h4>3.在rails项目中，进入config目录，修改 environment.rb 文件，添加如下内容：</h4>

<figure class='code'><figcaption><span>Ruby代码: </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">gem</span> <span class="s2">&quot;activerecord-oracle_enhanced-adapter&quot;</span><span class="p">,</span> <span class="ss">:lib</span> <span class="o">=&gt;</span> <span class="s2">&quot;active_record/connection_adapters/oracle_enhanced_adapter&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>4.修改config目录下的 database.yml 文件，配置数据库的格式：</h4>

<figure class='code'><figcaption><span>YAML代码:  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">oracle_enhanced</span>
</span><span class='line'>  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">192.168.23.162/ORCL</span>
</span><span class='line'>  <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">OPAC</span>
</span><span class='line'>  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">opac</span>
</span></code></pre></td></tr></table></div></figure>


<h4>5.在config/initializers 目录下创建文件 oracle.rb，当rails启动会自动执行，内容：</h4>

<figure class='code'><figcaption><span>Ruby代码: </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:ConnectionAdapters</span><span class="o">::</span><span class="no">OracleEnhancedAdapter</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">emulate_integers_by_column_name</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">emulate_dates_by_column_name</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">emulate_booleans_from_strings</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">string_to_date_format</span> <span class="o">=</span> <span class="s2">&quot;%d.%m.%Y&quot;</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">string_to_time_format</span> <span class="o">=</span> <span class="s2">&quot;%d.%m.%Y %H:%M:%S&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<br>


<hr />

<h5>下面是网上找的一些资料：</h5>

<p>rails开发中的Oracle问题</p>

<p>1.关联查询时的条件字段要明确指定</p>

<p>碰到的问题为mysql下order by id正常, Oracle报错：OCIError: ORA-00918: column ambiguously defined</p>

<p>2.`表名`问题</p>

<p>mysql会给表名外加 &#8220; (注意不是单引号), 手工加条件(如排序: order by `departments`.id)时,mysql正常，Oracle报错： OCIError: ORA-00911: invalid character</p>

<p>3.级联更新问题</p>

<p>has_one、has_many如未设置:dependent=>:delete/:delete_all，解除子项关联时，默认会去更新子项的外键为NULL，mysql下没问题，Oracle报错：OCIError: ORA-01407: cannot update</p>

<p>4.日期问题</p>

<p>2个短格式(yyyy-mm-dd)日期(一个从数据库取)直接相减求时间差得到相差天数, mysql下正常，oracle下出错, 可以采取date.to_s(:db).to_date的办法解决</p>

<p>5.修改字段</p>

<p>如果字段值不为空，oracle下不可修改字段类型，mysql下可以，可以用增加临时字段的方式解决。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ruby 图片分类归档小程序]]></title>
    <link href="http://duyw.github.com/blog/2010/11/25/ruby-tu-pian-fen-lei-gui-dang-xiao-cheng-xu/"/>
    <updated>2010-11-25T10:50:00+08:00</updated>
    <id>http://duyw.github.com/blog/2010/11/25/ruby-tu-pian-fen-lei-gui-dang-xiao-cheng-xu</id>
    <content type="html"><![CDATA[<p>需求简述：</p>

<p>1 处理某个目录下EMS快递单扫描图片，文件名格式：“20100702111538015-EF000000000CS.jpg”。</p>

<p>2 连接SQL Server 数据库，表中已有EMS编号，将匹配的图片移动到指定目录。重复扫描的图片只保留最新一张，其余错误文件移动到指定目录。</p>

<p>3 将匹配正确的图片名称存储到数据库。</p>

<p>4 程序定时执行，并记录日志。</p>

<p>程序代码如下：</p>

<!-- more -->




<figure class='code'><figcaption><span>Ruby代码: ems.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;mssql.rb&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;FileUtils&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;yaml&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;-----------------------------------------------------------------&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d  %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  程序运行&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#处理失败总数</span>
</span><span class='line'>
</span><span class='line'><span class="n">config</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;config.yml&quot;</span><span class="p">))</span>  <span class="c1">#加载配置文件 config.yml</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#获取配置文件中的值</span>
</span><span class='line'><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;db&quot;</span><span class="o">][</span><span class="s2">&quot;host&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">dbname</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;db&quot;</span><span class="o">][</span><span class="s2">&quot;dbname&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;db&quot;</span><span class="o">][</span><span class="s2">&quot;username&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">password</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;db&quot;</span><span class="o">][</span><span class="s2">&quot;password&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;path&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">db</span> <span class="o">=</span> <span class="no">MssqlDb</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">dbname</span><span class="p">,</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>   <span class="c1">#数据库连接，四个参数分别为主机名、数据库名称、用户名、密码</span>
</span><span class='line'><span class="n">picture_names</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'><span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">open</span>  <span class="c1">#判断如果数据库连接成功才执行下面的操作</span>
</span><span class='line'>  <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/pictures&quot;</span>  <span class="c1">#在该目录下创建文件夹</span>
</span><span class='line'>  <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/files&quot;</span>  <span class="c1">#在该目录下创建文件夹</span>
</span><span class='line'>  <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/error_files&quot;</span>  <span class="c1">#在该目录下创建文件夹</span>
</span><span class='line'>  <span class="no">FileUtils</span><span class="o">.</span><span class="n">cd</span>        <span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/pictures&quot;</span>
</span><span class='line'>  <span class="c1">#Dir.chdir(&quot;#{path}/pictures&quot;)#将当前目录改为 d:\ems\pictures</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names1</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.jpg&#39;</span><span class="p">)</span> <span class="c1">#获取所有后缀为 .jpg 的文件的文件名</span>
</span><span class='line'>  <span class="n">count</span> <span class="o">=</span> <span class="n">picture_names1</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>  <span class="n">picture_names3</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names1</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">p</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">35</span>
</span><span class='line'>      <span class="n">error_count</span> <span class="o">+=</span><span class="mi">1</span>
</span><span class='line'>      <span class="no">FileUtils</span><span class="o">.</span><span class="n">mv</span> <span class="nb">p</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">error_files&quot;</span>   <span class="c1">#将图片移到 path 目录下的 error_files 中</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2"> 名称错误&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names1</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.jpg&#39;</span><span class="p">)</span> <span class="c1">#获取所有后缀为 .jpg 的文件的文件名</span>
</span><span class='line'>  <span class="n">picture_names2</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.jpg&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names1</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">p1</span><span class="o">|</span>
</span><span class='line'>    <span class="n">picture_names2</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">p2</span><span class="o">|</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">p1</span> <span class="o">!=</span> <span class="n">p2</span> <span class="ow">and</span> <span class="n">p1</span><span class="o">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">13</span><span class="o">]</span> <span class="o">==</span> <span class="n">p2</span><span class="o">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">13</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="n">picture_names2</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names3</span> <span class="o">=</span> <span class="n">picture_names1</span> <span class="o">-</span> <span class="n">picture_names2</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names3</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">p3</span><span class="o">|</span>
</span><span class='line'>    <span class="n">error_count</span> <span class="o">+=</span><span class="mi">1</span>
</span><span class='line'>    <span class="no">FileUtils</span><span class="o">.</span><span class="n">mv</span> <span class="n">p3</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">error_files&quot;</span>   <span class="c1">#将图片移到 path 目录下的 error_files 中</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">p3</span><span class="si">}</span><span class="s2"> 重复&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">picture_names</span> <span class="o">=</span> <span class="n">picture_names2</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">picture_names</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">0</span> <span class="c1">#如果names不为空</span>
</span><span class='line'>    <span class="n">picture_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
</span><span class='line'>      <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;select CONVERT(VARCHAR(6), SendDate, 112) AS senddate from tb_ems where emscode= &#39;</span><span class="si">#{</span><span class="n">n</span><span class="o">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">17</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">data</span>  <span class="c1">#获取查询结果</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">rows</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">#如果未找到相应的记录</span>
</span><span class='line'>        <span class="no">FileUtils</span><span class="o">.</span><span class="n">mv</span> <span class="n">n</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">error_files&quot;</span>   <span class="c1">#将图片移到 path 目录下的 error_files 中</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2"> 数据库中未找到相应记录&quot;</span>
</span><span class='line'>        <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">elsif</span><span class="p">(</span> <span class="n">rows</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">[</span><span class="mi">0</span><span class="o">]!=</span> <span class="kp">nil</span> <span class="p">)</span>  <span class="c1">#如果找到相应的记录，并且 senddate 字段不为空</span>
</span><span class='line'>        <span class="n">sendtime</span> <span class="o">=</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>        <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">files</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">sendtime</span> <span class="c1">#创建目录</span>
</span><span class='line'>        <span class="no">FileUtils</span><span class="o">.</span><span class="n">mv</span> <span class="n">n</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">files</span><span class="se">\\</span><span class="si">#{</span><span class="n">sendtime</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1">#将图片移到新创建的目录下 </span>
</span><span class='line'>        <span class="c1">#puts &quot;#{n} 已经移动到 #{path}\\files\\#{sendtime}&quot;</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;update tb_ems set filename = &#39;</span><span class="si">#{</span><span class="n">sendtime</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">n</span><span class="si">}</span><span class="s2">&#39; where emscode= &#39;</span><span class="si">#{</span><span class="n">n</span><span class="o">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">17</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">elsif</span><span class="p">(</span> <span class="n">rows</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">[</span><span class="mi">0</span><span class="o">]==</span> <span class="kp">nil</span> <span class="p">)</span>  <span class="c1">#如果找到相应的记录，但是 senddate 字段为空</span>
</span><span class='line'>        <span class="no">FileUtils</span><span class="o">.</span><span class="n">mv</span> <span class="n">n</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">error_files&quot;</span>   <span class="c1">#将图片移到 path 目录下的 error_files 中</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2"> 数据库中SendDate（发送时间）字段为空&quot;</span>
</span><span class='line'>        <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="no">FileUtils</span><span class="o">.</span><span class="n">mv</span> <span class="n">n</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="se">\\</span><span class="s2">error_files&quot;</span>   <span class="c1">#将图片移到 path 目录下的 error_files 中</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2"> 数据库中存在多条记录&quot;</span>
</span><span class='line'>        <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="n">close</span> <span class="c1">#关闭数据库连接</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span>  <span class="s2">&quot;共有</span><span class="si">#{</span><span class="n">count</span><span class="si">}</span><span class="s2">项任务...错误</span><span class="si">#{</span><span class="n">error_count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d  %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  程序结束&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Ruby代码:mssql.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;win32ole&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MssqlDb</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">mdb</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">pass</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@host</span><span class="o">=</span> <span class="n">host</span>
</span><span class='line'>    <span class="vi">@mdb</span><span class="o">=</span><span class="vi">@database</span><span class="o">=</span> <span class="n">mdb</span>
</span><span class='line'>    <span class="vi">@username</span><span class="o">=</span> <span class="n">user</span>
</span><span class='line'>    <span class="vi">@password</span><span class="o">=</span> <span class="n">pass</span>
</span><span class='line'>    <span class="vi">@connection</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="vi">@data</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="vi">@fields</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">open</span>
</span><span class='line'>    <span class="n">connection_string</span> <span class="o">=</span> <span class="s2">&quot;Provider=SQLOLEDB.1;User ID=</span><span class="si">#@username</span><span class="s2">;password=</span><span class="si">#@password</span><span class="s2">;Data Source=</span><span class="si">#@host</span><span class="s2">,1433;Initial Catalog=</span><span class="si">#@mdb</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="vi">@connection</span> <span class="o">=</span> <span class="no">WIN32OLE</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;ADODB.Connection&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="vi">@connection</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@isconnected</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">rescue</span>
</span><span class='line'>      <span class="vi">@isconnected</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;数据库链接失败 !!!&quot;</span>
</span><span class='line'>      <span class="kp">nil</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span class='line'>    <span class="n">recordset</span> <span class="o">=</span> <span class="no">WIN32OLE</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;ADODB.Recordset&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">recordset</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="vi">@connection</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@fields</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">recordset</span><span class="o">.</span><span class="n">Fields</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
</span><span class='line'>      <span class="vi">@fields</span> <span class="o">&lt;&lt;</span> <span class="n">field</span><span class="o">.</span><span class="n">Name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="vi">@data</span> <span class="o">=</span> <span class="n">recordset</span><span class="o">.</span><span class="n">GetRows</span><span class="o">.</span><span class="n">transpose</span>
</span><span class='line'>    <span class="k">rescue</span>
</span><span class='line'>      <span class="vi">@data</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">recordset</span><span class="o">.</span><span class="n">Close</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@connection</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">close</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@isconnected</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>      <span class="vi">@connection</span><span class="o">.</span><span class="n">Close</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;请检查程序配置是否正确 数据库访问是否正常&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:data</span><span class="p">,</span> <span class="ss">:fields</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>YAML代码:config.yml  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">dbname</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">test</span>        <span class="c1"># 数据库名称</span>
</span><span class='line'>  <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sa</span>        <span class="c1"># 用户名</span>
</span><span class='line'>  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sa</span>        <span class="c1"># 密码</span>
</span><span class='line'>  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>     <span class="c1"># 主机名</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">D:\ems</span>        <span class="c1">#文件路径</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[windows 平台部署rails]]></title>
    <link href="http://duyw.github.com/blog/2010/11/19/windows-ping-tai-bu-shu-rails/"/>
    <updated>2010-11-19T18:33:00+08:00</updated>
    <id>http://duyw.github.com/blog/2010/11/19/windows-ping-tai-bu-shu-rails</id>
    <content type="html"><![CDATA[<p>　　公司一个现有项目是用 ruby 1.8.6 + rails1.2.6 做的，之前的客户服务器都是linux系统，这次客户服务器用的是windows，所以研究了一下部署方案，从网上各方搜集资料，最后配置成功，整理在此：</p>

<h3>1. mongrel 安装</h3>

<p>由于默认的gem版本为0.9.4，版本太旧了，无法运行gem install mongrel 命令，所以要先升级gem版本，首先下载 rubygem_update ,地址：http://rubyforge.org/frs/download.php/70695/rubygems-update-1.3.7.gem</p>

<p>下载后在cmd下cd到rubygems-update-1.3.7.gem所在的目录</p>

<p>安装命令：<code>gem install rubygems-update-1.3.7.gem</code></p>

<p>接下来升级gem，命令：<code>update_rubygems</code></p>

<p>安装完成后 查看gem版本，输入 <code>gem -v</code> 会显示 “1.3.7”，至此，升级成功。</p>

<p>安装mongrel，运行命令：<code>gem install mongrel</code></p>

<p>安装完成后，在rail项目下运行 <code>ruby script/server</code> 启动时，会使用mongrel而不是webrake。</p>

<!-- more -->


<h3>2. 安装mongrel_service</h3>

<p>命令：<code>gem install mongrel_service</code></p>

<h3>3. 将mongrel设置为系统服务</h3>

<p>命令：<code>mongrel_rails service::install -N zc0 -c d:\svn\zc_hn\code\zc -p 3000 -e development</code></p>

<p>（zc0为服务名称，d:\svn\zc_hn\code\zc 为项目路径，development为开发模式，3000为端口）</p>

<p>执行后在系统服务中会增加一项名为zc的服务。</p>

<p>启动：<code>net start zc0</code></p>

<p>关闭：<code>net stop zc0</code></p>

<p>删除服务：先关闭，然后命令行执行：<code>mongrel_rails service::remove -N zc0</code></p>

<p>如果需要安装多个mongrel实例，那么可以这样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mongrel_rails service::install -N zc0 -c d:\svn\zc_hn\code\zc -p 3000 –e production
</span><span class='line'>mongrel_rails service::install -N zc1 -c d:\svn\zc_hn\code\zc -p 3001 –e production
</span><span class='line'>……</span></code></pre></td></tr></table></div></figure>


<h3>4. 安装、配置 apache</h3>

<p>从Apache网站下载Windows版本的Apache2.2，运行安装。</p>

<p>安装后进入安装目录下修改 httpd.conf文件,将以下三个模块的注释去掉</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LoadModule proxy_module modules/mod_proxy.so
</span><span class='line'>LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
</span><span class='line'>LoadModule proxy_http_module modules/mod_proxy_http.so
</span></code></pre></td></tr></table></div></figure>


<p>如果你希望对页面输出使用压缩，也需要取消如下模块的注释：</p>

<p><code>LoadModule deflate_module modules/mod_deflate.so</code></p>

<p>然后按如下内容配置基于HTTP代理的负载均衡，在最后添加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ProxyRequests Off    
</span><span class='line'>   
</span><span class='line'>  BalancerMember http://localhost:3000    
</span><span class='line'>  BalancerMember http://localhost:3001    
</span><span class='line'>   
</span><span class='line'>  ServerName www.xxx.com    
</span><span class='line'>  DocumentRoot d:/svn/zc_hn/code/zc/    
</span><span class='line'>  ProxyPass images !    
</span><span class='line'>  ProxyPass stylesheets !    
</span><span class='line'>  ProxyPass javascripts !    
</span><span class='line'>  ProxyPass / balancer://myCluster/    
</span><span class='line'>  ProxyPassReverse / balancer://myCluster/    
</span><span class='line'>  ProxyPreserveHost on    </span></code></pre></td></tr></table></div></figure>


<p></p>

<p>(网上的资料中在images 前面有&#8221;/&#8221;,访问的时候页面图片css都没了，只有数据，去掉后正常)</p>

<hr />

<p>myCluster定义了群集中的每个mongrel应用服务器节点。ProxyPass /images !指明该URL开始的请求不代理给Mongrel群集，而由Apache自己处理。重起Apache，然后打开浏览器访问www.xxx.com，检查配置是否正确。</p>

<p>至此，在Windows Server上面一个具备良好稳定性和性能的Ruby on rails生产环境就搭建好了。</p>

<p>对于页面输出，还可以使用mod_deflate进行输出内容压缩，以提高页面下载速度，这个就留给大家自己配置了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL 数据库自动备份脚本]]></title>
    <link href="http://duyw.github.com/blog/2010/11/19/mysql-shu-ju-ku-zi-dong-bei-fen-jiao-ben/"/>
    <updated>2010-11-19T00:19:00+08:00</updated>
    <id>http://duyw.github.com/blog/2010/11/19/mysql-shu-ju-ku-zi-dong-bei-fen-jiao-ben</id>
    <content type="html"><![CDATA[<p>功能及说明：</p>

<ol>
<li><p>利用Linux的计划任务功能实现mysql数据库的定时备份，也可以手动执行 mysql_backup.sh</p></li>
<li><p>备份文件名称按照日期存储</p></li>
<li><p>可以删除旧的备份文件，只保留最近n天的备份数据源。</p></li>
<li><p>备份过程都将记录到日志文件中，便于查看。</p></li>
<li><p>提供三种备份方式，</p>

<ul>
<li><p>mysqldump：将数据导出为sql文件</p></li>
<li><p>mysqlhotcopy：参看最后面的介绍</p></li>
<li><p>tar：先停止mysql服务然后将数据库文件打包</p></li>
</ul>
</li>
<li><p>如果已经做了当天的备份，重复执行不会覆盖原有备份，需要手动删除旧备份才可以重新生成备份文件</p></li>
</ol>


<!-- more -->


<br>


<p>操作步骤：</p>

<h3>第1步  编写定时备份脚本mysql_backup.sh，内容如下：</h3>

<figure class='code'><figcaption><span>shell脚本: mysql_backup.sh  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash </span>
</span><span class='line'><span class="c">#This is a ShellScript For Auto DB Backup </span>
</span><span class='line'><span class="c">#2010 -11 </span>
</span><span class='line'>
</span><span class='line'><span class="c">#Setting </span>
</span><span class='line'><span class="c">#设置数据库名，数据库登录名，密码，备份路径，日志路径，数据文件位置， </span>
</span><span class='line'><span class="c">#以及备份方式 </span>
</span><span class='line'><span class="c">#默认情况下备份方式是tar，还可以是mysqldump,mysqldotcopy </span>
</span><span class='line'><span class="c">#默认情况下，用root(空)登录mysql数据库，备份至/root/namexxxxx.tgz </span>
</span><span class='line'><span class="nv">DBName</span> <span class="o">=</span> zc
</span><span class='line'><span class="nv">DBUser</span> <span class="o">=</span> root
</span><span class='line'><span class="nv">DBPasswd</span> <span class="o">=</span> root
</span><span class='line'><span class="nv">BackupPath</span> <span class="o">=</span> /root/zc_db_back/
</span><span class='line'><span class="nv">LogFile</span> <span class="o">=</span> /root/zc_db_back/db.log
</span><span class='line'><span class="nv">DBPath</span> <span class="o">=</span> /var/lib/mysql/
</span><span class='line'>
</span><span class='line'><span class="c">#BackupMethod=mysqldump </span>
</span><span class='line'><span class="c">#BackupMethod=mysqlhotcopy </span>
</span><span class='line'><span class="nv">BackupMethod</span> <span class="o">=</span> tar
</span><span class='line'><span class="c">#Setting End </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nv">NewFile</span> <span class="o">=</span> <span class="s2">&quot;$BackupPath&quot;&quot;$DBName&quot;</span> _ <span class="k">$(</span> date +%Y%m%d <span class="k">)</span>.tgz
</span><span class='line'><span class="nv">DumpFile</span> <span class="o">=</span> <span class="s2">&quot;$BackupPath&quot;&quot;$DBName&quot;</span> _ <span class="k">$(</span> date +%Y%m%d <span class="k">)</span>
</span><span class='line'><span class="nv">OldFile</span> <span class="o">=</span> <span class="s2">&quot;$BackupPath&quot;&quot;$DBName&quot;</span> _ <span class="k">$(</span> date +%Y%m%d --date <span class="o">=</span> <span class="s1">&#39;3 days ago&#39;</span> <span class="k">)</span>.tgz
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;-------------------------------------------&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'><span class="nb">echo</span> <span class="k">$(</span> date + <span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span> <span class="k">)</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;--------------------------&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'><span class="c">#Delete Old File </span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -f <span class="nv">$OldFile</span> <span class="o">]</span>
</span><span class='line'><span class="k">then </span>
</span><span class='line'><span class="k">   </span>rm -f <span class="nv">$OldFile</span> &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>   <span class="nb">echo</span> <span class="s2">&quot;[$OldFile]Delete Old File Success!&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'><span class="k">else </span>
</span><span class='line'><span class="k">   </span><span class="nb">echo</span> <span class="s2">&quot;[$OldFile]No Old Backup File!&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'><span class="k">fi </span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -f <span class="nv">$NewFile</span> <span class="o">]</span>
</span><span class='line'><span class="k">then </span>
</span><span class='line'><span class="k">   </span><span class="nb">echo</span> <span class="s2">&quot;[$NewFile]The Backup File is exists,Can&#39;t Backup!&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'><span class="k">else </span>
</span><span class='line'><span class="k">   case</span> <span class="nv">$BackupMethod</span> in
</span><span class='line'>   mysqldump <span class="o">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">[</span> -z <span class="nv">$DBPasswd</span> <span class="o">]</span>
</span><span class='line'>      <span class="k">then </span>
</span><span class='line'><span class="k">         </span>mysqldump -u <span class="nv">$DBUser</span> --opt <span class="nv">$DBName</span> &gt; <span class="nv">$DumpFile</span>
</span><span class='line'>      <span class="k">else </span>
</span><span class='line'><span class="k">         </span>mysqldump -u <span class="nv">$DBUser</span> -p <span class="nv">$DBPasswd</span> --opt <span class="nv">$DBName</span> &gt; <span class="nv">$DumpFile</span>
</span><span class='line'>      <span class="k">fi </span>
</span><span class='line'><span class="k">      </span>tar czvf <span class="nv">$NewFile</span> <span class="nv">$DumpFile</span> &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;[$NewFile]Backup Success!&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'>      rm -rf <span class="nv">$DumpFile</span>
</span><span class='line'>      ;;
</span><span class='line'>   mysqlhotcopy <span class="o">)</span>
</span><span class='line'>      rm -rf <span class="nv">$DumpFile</span>
</span><span class='line'>      mkdir <span class="nv">$DumpFile</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">[</span> -z <span class="nv">$DBPasswd</span> <span class="o">]</span>
</span><span class='line'>      <span class="k">then </span>
</span><span class='line'><span class="k">         </span>mysqlhotcopy -u <span class="nv">$DBUser</span> <span class="nv">$DBName</span> <span class="nv">$DumpFile</span> &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      <span class="k">else </span>
</span><span class='line'><span class="k">         </span>mysqlhotcopy -u <span class="nv">$DBUser</span> -p <span class="nv">$DBPasswd</span> <span class="nv">$DBName</span> <span class="nv">$DumpFile</span> &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      <span class="k">fi </span>
</span><span class='line'><span class="k">      </span>tar czvf <span class="nv">$NewFile</span> <span class="nv">$DumpFile</span> &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;[$NewFile]Backup Success!&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'>      rm -rf <span class="nv">$DumpFile</span>
</span><span class='line'>      ;;
</span><span class='line'>   * <span class="o">)</span>
</span><span class='line'>      service mysql stop &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      tar czvf <span class="nv">$NewFile</span> <span class="nv">$DBPath$DBName</span> &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      service mysql start &gt;&gt; <span class="nv">$LogFile</span> 2&gt;&amp;1
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;[$NewFile]Backup Success!&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span><span class='line'>      ;;
</span><span class='line'>   <span class="k">esac </span>
</span><span class='line'><span class="k">fi </span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;-------------------------------------------&quot;</span> &gt;&gt; <span class="nv">$LogFile</span>
</span></code></pre></td></tr></table></div></figure>


<h3>第2步 修改参数</h3>

<p>参数包括：“设置数据库名，数据库登录名，密码，备份路径，日志路径，数据文件位置，备份方式”</p>

<blockquote><p>注意：备份路径必须是存在的路径</p></blockquote>

<h3>第3步  将脚本 mysql_backup.sh 设置为可执行</h3>

<p><code>chmod 755 mysql_backup.sh</code></p>

<h3>第4步 编辑定时任务，在root的crontab中，设置脚本执行周期(每天凌晨3点)</h3>

<p>关闭服务：<code>service crond stop</code></p>

<p>编辑任务列表： <code>crontab -e</code></p>

<p>添加内容： <code>0 3 * * * /root/Desktop/mysql_backup.sh</code></p>

<p>启动服务： <code>service crond start</code></p>

<p>重建加载： <code>service crond reload</code></p>

<h3>5 数据恢复：</h3>

<p>备份文件均为tar包，需要用tar解包，如果要恢复备份的数据，请先关闭mysql服务，</p>

<p>打包 ： <code>tar cvf + 打包后文件名 + 需打包文件夹名</code></p>

<p>解包 ： <code>tar xvf + 包名</code></p>

<p>将解出来的文件复制到mysql 数据库位置然后重新启动mysql服务即可。</p>

<br>


<hr />

<br>


<p>　　mysqlhotcopy是一个Perl脚本，最初由Tim Bunce编写并提供。它使用LOCK TABLES、FLUSH TABLES和cp或scp来快速备份数据库。它是备份数据库或单个表的最快的途径，但它只能运行在数据库目录所在的机器上。mysqlhotcopy只用于备份MyISAM。它运行在Unix和NetWare中。</p>

<p>mysqlhotcopy与mysqldump比较：</p>

<ol>
<li><p>前者是一个快速文件意义上的COPY，后者是一个数据库端的SQL语句集合。</p></li>
<li><p>前者只能运行在数据库目录所在的机器上，后者可以用在远程客户端，不过备份的文件还是保存在服务器上。</p></li>
<li><p>相同的地方都是在线执行 LOCK TABLES 以及 UNLOCK TABLES</p></li>
<li><p>前者恢复只需要COPY备份文件到源目录覆盖即可，后者需要导入SQL文件到原库中。(source 或 mysql &lt; bakfile.sql)</p></li>
<li><p>前者只适用于 MyISAM 引擎，而后则则可同时使用于MyISAM引擎和InodDB引擎.</p></li>
<li><p>前者在使用前必须安装perl-DBD-mysql包,而后者则不需要.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows MySQL 服务自动管理脚本]]></title>
    <link href="http://duyw.github.com/blog/2010/06/20/windows-mysql-fu-wu-zi-dong-guan-li-jiao-ben/"/>
    <updated>2010-06-20T00:09:00+08:00</updated>
    <id>http://duyw.github.com/blog/2010/06/20/windows-mysql-fu-wu-zi-dong-guan-li-jiao-ben</id>
    <content type="html"><![CDATA[<p>脚本说明：在开发过程中由于经常需要启动或停止MySQL服务，非常麻烦，于是编写了这个简单的批处理脚本，自动判断MySQL服务如果是启动状态则停止该服务，如果未启动，则启动。</p>

<figure class='code'><figcaption><span>脚本名称：mysql server.bat  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">echo</span> <span class="k">off</span>
</span><span class='line'>color b<span class="m">0</span>
</span><span class='line'>title 启动<span class="n">/关闭</span> MySQL服务
</span><span class='line'>tasklist <span class="n">/nh|</span> @findstr <span class="n">/i</span> <span class="s2">&quot;mysqld-nt.exe&quot;</span>
</span><span class='line'><span class="k">set</span>  <span class="nv">dyw</span><span class="o">=</span><span class="nv">%ERRORLEVEL%</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="nv">%dyw%</span> <span class="o">==</span> <span class="m">1</span> (
</span><span class='line'>  net start mysql
</span><span class='line'>) <span class="k">else</span> (
</span><span class='line'>  net stop mysql
</span><span class='line'>)
</span><span class='line'>ping -n <span class="m">3</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span><span class="p">&gt;</span><span class="n">nul</span>
</span><span class='line'>exit
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
